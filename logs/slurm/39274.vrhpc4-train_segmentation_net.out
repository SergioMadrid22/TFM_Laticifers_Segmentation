2025-07-27 18:33:19 INFO Starting training with configuration: {'model': {'name': 'unet', 'alias': 'unet_densenet121', 'encoder_name': 'densenet121', 'encoder_weights': 'imagenet', 'in_channels': 1, 'classes': 1, 'activation': 'sigmoid', 'dropout': 0.2}, 'dataset': {'root': '/data/smadper@alumno.upv.es/TFM/datasets/laticifers', 'patch_size': [512, 512], 'stride': [256, 256], 'num_patches': 20, 'dataset_csv': 'laticifer_dataset_index.csv', 'num_workers': 4, 'positive_ratio': 0.8, 'fg_threshold': 0.04, 'dist_transform': True, 'feature_dirs': {'enhanced': '/data/smadper@alumno.upv.es/TFM/datasets/laticifers/enhanced_images', 'mask': '/data/smadper@alumno.upv.es/TFM/datasets/laticifers/masks', 'distance': '/data/smadper@alumno.upv.es/TFM/datasets/laticifers/distance_maps_pt'}}, 'train': {'batch_size': 16, 'num_epochs': 70, 'learning_rate': 0.001, 'accumulation_steps': 1, 'save_dir': '/data/smadper@alumno.upv.es/TFM/checkpoints2/unet/20250727_183319_bce_dice_20patches', 'log_interval': 1, 'patience': 10, 'mixed_precision': True, 'experiment_name': 'bce_dice_20patches', 'timestamp': '20250727_183319'}, 'test': {'batch_size': 1}, 'loss': {'name': 'bce', 'cldice_alpha': 0.3, 'use_topographic': False, 'combine_with': 'dice', 'weights': {'main': 0.5, 'combined': 0.5}, 'topo': {'alpha': 2.0, 'beta': 1.0}}}
2025-07-27 18:33:19 INFO Experiment name: bce_dice_20patches
2025-07-27 18:33:19 INFO Loading model unet with settings {'name': 'unet', 'alias': 'unet_densenet121', 'encoder_name': 'densenet121', 'encoder_weights': 'imagenet', 'in_channels': 1, 'classes': 1, 'activation': 'sigmoid', 'dropout': 0.2}
preds: (tensor([[[[0.3756, 0.4766, 0.5733,  ..., 0.5084, 0.4950, 0.5138],
          [0.3598, 0.5835, 0.6288,  ..., 0.3747, 0.3384, 0.5263],
          [0.2663, 0.5578, 0.5475,  ..., 0.4298, 0.3889, 0.5519],
          ...,
          [0.3703, 0.4074, 0.4187,  ..., 0.3988, 0.5733, 0.6832],
          [0.3660, 0.4836, 0.5193,  ..., 0.5671, 0.5339, 0.5618],
          [0.4133, 0.5018, 0.5994,  ..., 0.4436, 0.5016, 0.4818]]],


        [[[0.4064, 0.4272, 0.5697,  ..., 0.3616, 0.5054, 0.5405],
          [0.5016, 0.6246, 0.5261,  ..., 0.3519, 0.4974, 0.6374],
          [0.3594, 0.5536, 0.3924,  ..., 0.2283, 0.4021, 0.6222],
          ...,
          [0.3500, 0.5291, 0.4746,  ..., 0.3683, 0.5178, 0.6916],
          [0.4142, 0.5005, 0.4683,  ..., 0.3483, 0.4686, 0.5556],
          [0.4060, 0.4690, 0.5034,  ..., 0.3449, 0.4001, 0.4437]]],


        [[[0.4501, 0.3844, 0.4232,  ..., 0.4290, 0.4036, 0.5530],
          [0.4784, 0.4224, 0.4382,  ..., 0.3511, 0.4457, 0.5784],
          [0.4324, 0.4305, 0.3780,  ..., 0.4275, 0.4163, 0.6612],
          ...,
          [0.4300, 0.4761, 0.5498,  ..., 0.5644, 0.6447, 0.7555],
          [0.3254, 0.4848, 0.4677,  ..., 0.5185, 0.6023, 0.6341],
          [0.4053, 0.5225, 0.5220,  ..., 0.4413, 0.4814, 0.4845]]],


        ...,


        [[[0.3858, 0.3891, 0.3973,  ..., 0.3838, 0.5133, 0.5340],
          [0.4941, 0.6282, 0.5923,  ..., 0.3626, 0.4970, 0.5610],
          [0.3732, 0.5142, 0.4502,  ..., 0.3907, 0.4826, 0.5616],
          ...,
          [0.3102, 0.5022, 0.4916,  ..., 0.3361, 0.4516, 0.7101],
          [0.2719, 0.5203, 0.4675,  ..., 0.4293, 0.5347, 0.6254],
          [0.3927, 0.4295, 0.5022,  ..., 0.4115, 0.4906, 0.5535]]],


        [[[0.4558, 0.3909, 0.4064,  ..., 0.3100, 0.4721, 0.6509],
          [0.4847, 0.4641, 0.5189,  ..., 0.2237, 0.5087, 0.7233],
          [0.4048, 0.5012, 0.3886,  ..., 0.2603, 0.4160, 0.7267],
          ...,
          [0.3097, 0.3867, 0.3499,  ..., 0.3285, 0.4689, 0.6034],
          [0.3767, 0.4589, 0.3678,  ..., 0.5545, 0.5299, 0.5817],
          [0.4079, 0.4043, 0.4666,  ..., 0.3746, 0.5626, 0.5194]]],


        [[[0.3508, 0.3858, 0.5063,  ..., 0.4157, 0.4755, 0.4585],
          [0.4206, 0.5690, 0.5635,  ..., 0.4984, 0.5883, 0.5535],
          [0.4435, 0.5713, 0.4735,  ..., 0.4314, 0.5095, 0.5217],
          ...,
          [0.3371, 0.5039, 0.5030,  ..., 0.4058, 0.4788, 0.6609],
          [0.3655, 0.4958, 0.4292,  ..., 0.5152, 0.4993, 0.5738],
          [0.4055, 0.5031, 0.4817,  ..., 0.4847, 0.5032, 0.4478]]]],
       device='cuda:0', grad_fn=<SigmoidBackward0>), tensor([[ 1.3469],
        [ 0.4738],
        [ 0.9561],
        [ 0.6935],
        [ 0.7182],
        [ 0.4842],
        [ 0.4256],
        [ 0.3053],
        [ 0.8398],
        [-0.2153],
        [ 0.6441],
        [ 0.1850],
        [ 0.7551],
        [ 0.2020],
        [ 0.3203],
        [ 1.0575]], device='cuda:0', grad_fn=<AddmmBackward0>))
Traceback (most recent call last):
  File "/data/smadper@alumno.upv.es/TFM/src/train.py", line 214, in <module>
    main(conf)
  File "/data/smadper@alumno.upv.es/TFM/src/train.py", line 181, in main
    best_model_path, best_dice, best_cldice, best_val_loss, best_epoch = train_model(model, train_loader, test_loader, conf)
                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/smadper@alumno.upv.es/TFM/src/train.py", line 129, in train_model
    loss = loss_fn(model(images), masks) / accumulation_steps
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/smadper@alumno.upv.es/TFM/src/utils.py", line 117, in fn
    print(f"shape preds: {preds.shape}, targets: {targets.shape}")
                          ^^^^^^^^^^^
AttributeError: 'tuple' object has no attribute 'shape'
