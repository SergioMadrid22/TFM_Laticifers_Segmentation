2025-07-21 23:13:44 INFO Starting training with configuration: {'model': {'name': 'unet', 'alias': 'unet_resnet18', 'encoder_name': 'resnet18', 'encoder_weights': 'imagenet', 'in_channels': 1, 'classes': 1, 'activation': 'sigmoid', 'dropout': 0.2}, 'dataset': {'root': '/data/smadper@alumno.upv.es/TFM/datasets/laticifers', 'patch_size': [512, 512], 'stride': [256, 256], 'num_patches': 10, 'dataset_csv': 'laticifer_dataset_index.csv', 'num_workers': 8, 'positive_ratio': 0.8, 'fg_threshold': 0.04, 'dist_transform': True, 'feature_dirs': {'enhanced': '/data/smadper@alumno.upv.es/TFM/datasets/laticifers/enhanced_images', 'mask': '/data/smadper@alumno.upv.es/TFM/datasets/laticifers/masks', 'distance': '/data/smadper@alumno.upv.es/TFM/datasets/laticifers/distance_maps_pt'}}, 'train': {'batch_size': 16, 'num_epochs': 100, 'learning_rate': 0.001, 'accumulation_steps': 1, 'save_dir': '/data/smadper@alumno.upv.es/TFM/checkpoints', 'log_interval': 1, 'patience': 10, 'mixed_precision': True, 'experiment_name': 'unet_resnet18_imagenet', 'timestamp': '20250721_231344'}, 'test': {'batch_size': 1, 'save_dir': '/data/smadper@alumno.upv.es/TFM/results'}, 'loss': {'name': 'bce', 'cldice_alpha': 0.3, 'use_topographic': True, 'combine_with': 'dice', 'weights': {'main': 0.5, 'combined': 0.5}, 'topo': {'alpha': 2.0, 'beta': 1.0}}}
2025-07-21 23:13:44 INFO Experiment name: unet_resnet18_imagenet
2025-07-21 23:13:44 INFO Loading model unet with settings {'name': 'unet', 'alias': 'unet_resnet18', 'encoder_name': 'resnet18', 'encoder_weights': 'imagenet', 'in_channels': 1, 'classes': 1, 'activation': 'sigmoid', 'dropout': 0.2}
/data/smadper@alumno.upv.es/TFM/src/datasets.py:243: UserWarning: Argument(s) 'mean, std' are not valid for transform GaussNoise
  A.GaussNoise(mean=0, std=25, p=0.2),  # Replaced var_limit
2025-07-21 23:14:16 INFO Epoch 001 | Train Loss: 0.8686 | Val Loss: 0.6288 | Dice: 0.0011 | clDice: 0.0002 |IoU: 0.0006 | LR: 0.001000
2025-07-21 23:14:48 INFO Epoch 002 | Train Loss: 0.3957 | Val Loss: 0.2955 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:15:19 INFO Epoch 003 | Train Loss: 0.2981 | Val Loss: 0.2459 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:15:51 INFO Epoch 004 | Train Loss: 0.2691 | Val Loss: 0.2088 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:16:22 INFO Epoch 005 | Train Loss: 0.2586 | Val Loss: 0.1873 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:16:53 INFO Epoch 006 | Train Loss: 0.2495 | Val Loss: 0.1796 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:17:24 INFO Epoch 007 | Train Loss: 0.2439 | Val Loss: 0.1758 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:17:55 INFO Epoch 008 | Train Loss: 0.2418 | Val Loss: 0.2834 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:18:26 INFO Epoch 009 | Train Loss: 0.2431 | Val Loss: 0.1598 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:18:57 INFO Epoch 010 | Train Loss: 0.2326 | Val Loss: 0.1453 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:19:27 INFO Epoch 011 | Train Loss: 0.2345 | Val Loss: 0.1389 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:19:57 INFO Epoch 012 | Train Loss: 0.2200 | Val Loss: 0.1358 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:20:28 INFO Epoch 013 | Train Loss: 0.2236 | Val Loss: 0.1372 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:20:59 INFO Epoch 014 | Train Loss: 0.2182 | Val Loss: 0.1337 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:21:29 INFO Epoch 015 | Train Loss: 0.2240 | Val Loss: 0.1297 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:21:59 INFO Epoch 016 | Train Loss: 0.2256 | Val Loss: 0.1332 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:22:30 INFO Epoch 017 | Train Loss: 0.2168 | Val Loss: 0.1253 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:23:00 INFO Epoch 018 | Train Loss: 0.2208 | Val Loss: 0.1323 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:23:30 INFO Epoch 019 | Train Loss: 0.2199 | Val Loss: 0.1471 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:24:01 INFO Epoch 020 | Train Loss: 0.2155 | Val Loss: 0.1335 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:24:31 INFO Epoch 021 | Train Loss: 0.2197 | Val Loss: 0.1251 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:25:03 INFO Epoch 022 | Train Loss: 0.2127 | Val Loss: 0.1228 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:25:33 INFO Epoch 023 | Train Loss: 0.2199 | Val Loss: 0.1226 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:26:03 INFO Epoch 024 | Train Loss: 0.2168 | Val Loss: 0.1227 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:26:34 INFO Epoch 025 | Train Loss: 0.2223 | Val Loss: 0.1199 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:27:05 INFO Epoch 026 | Train Loss: 0.2147 | Val Loss: 0.1202 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:27:36 INFO Epoch 027 | Train Loss: 0.2135 | Val Loss: 0.1189 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:28:06 INFO Epoch 028 | Train Loss: 0.2070 | Val Loss: 0.1178 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:28:37 INFO Epoch 029 | Train Loss: 0.2099 | Val Loss: 0.1160 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:29:08 INFO Epoch 030 | Train Loss: 0.2109 | Val Loss: 0.1144 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:29:38 INFO Epoch 031 | Train Loss: 0.2126 | Val Loss: 0.1255 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:30:08 INFO Epoch 032 | Train Loss: 0.2186 | Val Loss: 0.1124 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:30:38 INFO Epoch 033 | Train Loss: 0.2131 | Val Loss: 0.1151 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:31:09 INFO Epoch 034 | Train Loss: 0.2109 | Val Loss: 0.1217 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:31:39 INFO Epoch 035 | Train Loss: 0.2158 | Val Loss: 0.1170 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:32:09 INFO Epoch 036 | Train Loss: 0.2116 | Val Loss: 0.1151 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:32:39 INFO Epoch 037 | Train Loss: 0.2056 | Val Loss: 0.1152 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:33:10 INFO Epoch 038 | Train Loss: 0.2055 | Val Loss: 0.1086 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:33:41 INFO Epoch 039 | Train Loss: 0.2094 | Val Loss: 0.1140 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:34:11 INFO Epoch 040 | Train Loss: 0.2166 | Val Loss: 0.1123 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:34:41 INFO Epoch 041 | Train Loss: 0.2111 | Val Loss: 0.1098 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:35:12 INFO Epoch 042 | Train Loss: 0.2079 | Val Loss: 0.1115 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:35:42 INFO Epoch 043 | Train Loss: 0.2105 | Val Loss: 0.1104 | Dice: 0.0001 | clDice: 0.0002 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:36:12 INFO Epoch 044 | Train Loss: 0.2066 | Val Loss: 0.1103 | Dice: 0.0001 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:36:42 INFO Epoch 045 | Train Loss: 0.2077 | Val Loss: 0.1239 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:37:13 INFO Epoch 046 | Train Loss: 0.2128 | Val Loss: 0.1112 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:37:43 INFO Epoch 047 | Train Loss: 0.2095 | Val Loss: 0.1121 | Dice: 0.0000 | clDice: 0.0000 |IoU: 0.0000 | LR: 0.001000
2025-07-21 23:38:13 INFO Early stopping at epoch 48 | Best Dice: 0.0011 at epoch 38
Traceback (most recent call last):
  File "/data/smadper@alumno.upv.es/TFM/src/train.py", line 208, in <module>
    main(conf)
  File "/data/smadper@alumno.upv.es/TFM/src/train.py", line 177, in main
    save_metadata(os.path.dirname(best_model_path), model, conf, best_dice, best_val_loss, best_epoch)
TypeError: save_metadata() missing 1 required positional argument: 'best_epoch'
