2025-07-22 00:35:59 INFO Starting training with configuration: {'model': {'name': 'unet', 'alias': 'unet_timm-resnest50d', 'encoder_name': 'timm-resnest50d', 'encoder_weights': 'imagenet', 'in_channels': 1, 'classes': 1, 'activation': 'sigmoid', 'dropout': 0.2}, 'dataset': {'root': '/data/smadper@alumno.upv.es/TFM/datasets/laticifers', 'patch_size': [512, 512], 'stride': [256, 256], 'num_patches': 20, 'dataset_csv': 'laticifer_dataset_index.csv', 'num_workers': 8, 'positive_ratio': 0.8, 'fg_threshold': 0.04, 'dist_transform': True, 'feature_dirs': {'enhanced': '/data/smadper@alumno.upv.es/TFM/datasets/laticifers/enhanced_images', 'mask': '/data/smadper@alumno.upv.es/TFM/datasets/laticifers/masks', 'distance': '/data/smadper@alumno.upv.es/TFM/datasets/laticifers/distance_maps_pt'}}, 'train': {'batch_size': 16, 'num_epochs': 100, 'learning_rate': 0.001, 'accumulation_steps': 1, 'save_dir': '/data/smadper@alumno.upv.es/TFM/checkpoints', 'log_interval': 1, 'patience': 10, 'mixed_precision': True, 'experiment_name': 'topobce_dice', 'timestamp': '20250722_003559'}, 'test': {'batch_size': 1, 'save_dir': '/data/smadper@alumno.upv.es/TFM/results'}, 'loss': {'name': 'bce', 'cldice_alpha': 0.3, 'use_topographic': True, 'combine_with': 'dice', 'weights': {'main': 0.5, 'combined': 0.5}, 'topo': {'alpha': 2.0, 'beta': 1.0}}}
2025-07-22 00:35:59 INFO Experiment name: topobce_dice
2025-07-22 00:35:59 INFO Loading model unet with settings {'name': 'unet', 'alias': 'unet_timm-resnest50d', 'encoder_name': 'timm-resnest50d', 'encoder_weights': 'imagenet', 'in_channels': 1, 'classes': 1, 'activation': 'sigmoid', 'dropout': 0.2}
2025-07-22 00:35:59 INFO Loading pretrained weights from Hugging Face hub (timm/resnest50d.in1k)
2025-07-22 00:35:59 INFO [timm/resnest50d.in1k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-07-22 00:35:59 INFO Converted input conv conv1.0 pretrained weights from 3 to 1 channel(s)
2025-07-22 00:35:59 INFO Missing keys (fc.weight, fc.bias) discovered while loading pretrained weights. This is expected if model is being adapted.
2025-07-22 00:36:52 INFO Epoch 001 | Train Loss: 1.1556 | Val Loss: 0.7745 | Dice: 0.0750 | clDice: 0.0892 |IoU: 0.0390 | LR: 0.001000
2025-07-22 00:37:42 INFO Epoch 002 | Train Loss: 0.7525 | Val Loss: 0.6215 | Dice: 0.0002 | clDice: 0.0002 |IoU: 0.0001 | LR: 0.001000
2025-07-22 00:38:34 INFO Epoch 003 | Train Loss: 0.6942 | Val Loss: 0.6097 | Dice: 0.3080 | clDice: 0.3166 |IoU: 0.1824 | LR: 0.001000
2025-07-22 00:39:25 INFO Epoch 004 | Train Loss: 0.6683 | Val Loss: 0.5640 | Dice: 0.3910 | clDice: 0.4207 |IoU: 0.2431 | LR: 0.001000
2025-07-22 00:40:17 INFO Epoch 005 | Train Loss: 0.6588 | Val Loss: 0.5402 | Dice: 0.4080 | clDice: 0.4499 |IoU: 0.2567 | LR: 0.001000
2025-07-22 00:41:08 INFO Epoch 006 | Train Loss: 0.6457 | Val Loss: 0.4837 | Dice: 0.4301 | clDice: 0.4648 |IoU: 0.2744 | LR: 0.001000
2025-07-22 00:41:58 INFO Epoch 007 | Train Loss: 0.6431 | Val Loss: 0.5537 | Dice: 0.3995 | clDice: 0.4068 |IoU: 0.2497 | LR: 0.001000
2025-07-22 00:42:49 INFO Epoch 008 | Train Loss: 0.6392 | Val Loss: 0.5561 | Dice: 0.3993 | clDice: 0.4340 |IoU: 0.2496 | LR: 0.001000
2025-07-22 00:43:39 INFO Epoch 009 | Train Loss: 0.6319 | Val Loss: 0.9862 | Dice: 0.2521 | clDice: 0.2683 |IoU: 0.1448 | LR: 0.001000
2025-07-22 00:44:30 INFO Epoch 010 | Train Loss: 0.6243 | Val Loss: 0.5217 | Dice: 0.4129 | clDice: 0.4320 |IoU: 0.2604 | LR: 0.001000
2025-07-22 00:45:21 INFO Epoch 011 | Train Loss: 0.6260 | Val Loss: 0.6175 | Dice: 0.3643 | clDice: 0.3570 |IoU: 0.2228 | LR: 0.001000
2025-07-22 00:46:11 INFO Epoch 012 | Train Loss: 0.6284 | Val Loss: 0.5559 | Dice: 0.3992 | clDice: 0.4365 |IoU: 0.2496 | LR: 0.001000
2025-07-22 00:47:02 INFO Epoch 013 | Train Loss: 0.6260 | Val Loss: 0.4621 | Dice: 0.4450 | clDice: 0.4737 |IoU: 0.2863 | LR: 0.001000
2025-07-22 00:47:53 INFO Epoch 014 | Train Loss: 0.6254 | Val Loss: 0.4809 | Dice: 0.4351 | clDice: 0.4379 |IoU: 0.2782 | LR: 0.001000
2025-07-22 00:48:44 INFO Epoch 015 | Train Loss: 0.6282 | Val Loss: 0.6094 | Dice: 0.3702 | clDice: 0.4005 |IoU: 0.2274 | LR: 0.001000
2025-07-22 00:49:34 INFO Epoch 016 | Train Loss: 0.6198 | Val Loss: 0.4670 | Dice: 0.4394 | clDice: 0.4466 |IoU: 0.2821 | LR: 0.001000
2025-07-22 00:50:25 INFO Epoch 017 | Train Loss: 0.6220 | Val Loss: 0.4753 | Dice: 0.4494 | clDice: 0.4707 |IoU: 0.2902 | LR: 0.001000
2025-07-22 00:51:15 INFO Epoch 018 | Train Loss: 0.6225 | Val Loss: 0.5103 | Dice: 0.4300 | clDice: 0.4638 |IoU: 0.2742 | LR: 0.001000
2025-07-22 00:52:06 INFO Epoch 019 | Train Loss: 0.6198 | Val Loss: 0.4915 | Dice: 0.4281 | clDice: 0.4508 |IoU: 0.2725 | LR: 0.001000
2025-07-22 00:52:57 INFO Epoch 020 | Train Loss: 0.6196 | Val Loss: 0.4580 | Dice: 0.4525 | clDice: 0.4776 |IoU: 0.2925 | LR: 0.001000
2025-07-22 00:53:48 INFO Epoch 021 | Train Loss: 0.6159 | Val Loss: 0.5693 | Dice: 0.3824 | clDice: 0.3985 |IoU: 0.2367 | LR: 0.001000
2025-07-22 00:54:39 INFO Epoch 022 | Train Loss: 0.6170 | Val Loss: 0.4463 | Dice: 0.4549 | clDice: 0.4817 |IoU: 0.2946 | LR: 0.001000
2025-07-22 00:55:29 INFO Epoch 023 | Train Loss: 0.6222 | Val Loss: 0.5008 | Dice: 0.4240 | clDice: 0.4302 |IoU: 0.2692 | LR: 0.001000
2025-07-22 00:56:20 INFO Epoch 024 | Train Loss: 0.6191 | Val Loss: 0.4552 | Dice: 0.4676 | clDice: 0.4946 |IoU: 0.3056 | LR: 0.001000
2025-07-22 00:57:11 INFO Epoch 025 | Train Loss: 0.6163 | Val Loss: 0.4714 | Dice: 0.4414 | clDice: 0.4617 |IoU: 0.2833 | LR: 0.001000
2025-07-22 00:58:01 INFO Epoch 026 | Train Loss: 0.6169 | Val Loss: 0.4396 | Dice: 0.4700 | clDice: 0.5009 |IoU: 0.3074 | LR: 0.001000
2025-07-22 00:58:51 INFO Epoch 027 | Train Loss: 0.6123 | Val Loss: 0.4606 | Dice: 0.4615 | clDice: 0.4973 |IoU: 0.3002 | LR: 0.001000
2025-07-22 00:59:42 INFO Epoch 028 | Train Loss: 0.6158 | Val Loss: 0.4701 | Dice: 0.4560 | clDice: 0.4992 |IoU: 0.2955 | LR: 0.001000
2025-07-22 01:00:33 INFO Epoch 029 | Train Loss: 0.6100 | Val Loss: 0.4229 | Dice: 0.4729 | clDice: 0.4959 |IoU: 0.3101 | LR: 0.001000
2025-07-22 01:01:23 INFO Epoch 030 | Train Loss: 0.6122 | Val Loss: 0.4323 | Dice: 0.4579 | clDice: 0.4775 |IoU: 0.2972 | LR: 0.001000
2025-07-22 01:02:13 INFO Epoch 031 | Train Loss: 0.6071 | Val Loss: 0.4368 | Dice: 0.4796 | clDice: 0.5183 |IoU: 0.3156 | LR: 0.001000
2025-07-22 01:03:04 INFO Epoch 032 | Train Loss: 0.6128 | Val Loss: 0.4316 | Dice: 0.4626 | clDice: 0.4896 |IoU: 0.3013 | LR: 0.001000
2025-07-22 01:03:55 INFO Epoch 033 | Train Loss: 0.6140 | Val Loss: 0.4372 | Dice: 0.4779 | clDice: 0.5138 |IoU: 0.3143 | LR: 0.001000
2025-07-22 01:04:46 INFO Epoch 034 | Train Loss: 0.6213 | Val Loss: 0.4315 | Dice: 0.4745 | clDice: 0.5142 |IoU: 0.3113 | LR: 0.001000
2025-07-22 01:05:35 INFO Epoch 035 | Train Loss: 0.6129 | Val Loss: 0.4320 | Dice: 0.4734 | clDice: 0.4932 |IoU: 0.3105 | LR: 0.001000
2025-07-22 01:06:25 INFO Epoch 036 | Train Loss: 0.6074 | Val Loss: 0.4462 | Dice: 0.4582 | clDice: 0.4774 |IoU: 0.2974 | LR: 0.001000
2025-07-22 01:07:16 INFO Epoch 037 | Train Loss: 0.6084 | Val Loss: 0.4226 | Dice: 0.4675 | clDice: 0.4883 |IoU: 0.3055 | LR: 0.001000
2025-07-22 01:08:07 INFO Epoch 038 | Train Loss: 0.6116 | Val Loss: 0.4448 | Dice: 0.4806 | clDice: 0.5079 |IoU: 0.3166 | LR: 0.001000
2025-07-22 01:08:56 INFO Epoch 039 | Train Loss: 0.6092 | Val Loss: 0.4299 | Dice: 0.4825 | clDice: 0.5107 |IoU: 0.3183 | LR: 0.001000
2025-07-22 01:09:46 INFO Epoch 040 | Train Loss: 0.6145 | Val Loss: 0.4457 | Dice: 0.4752 | clDice: 0.5028 |IoU: 0.3119 | LR: 0.001000
2025-07-22 01:10:36 INFO Epoch 041 | Train Loss: 0.6069 | Val Loss: 0.4264 | Dice: 0.4770 | clDice: 0.4985 |IoU: 0.3135 | LR: 0.001000
2025-07-22 01:11:26 INFO Epoch 042 | Train Loss: 0.6077 | Val Loss: 0.4176 | Dice: 0.4760 | clDice: 0.4980 |IoU: 0.3127 | LR: 0.001000
2025-07-22 01:12:17 INFO Epoch 043 | Train Loss: 0.6065 | Val Loss: 0.4199 | Dice: 0.4758 | clDice: 0.4870 |IoU: 0.3127 | LR: 0.001000
2025-07-22 01:13:06 INFO Epoch 044 | Train Loss: 0.6059 | Val Loss: 0.4259 | Dice: 0.4802 | clDice: 0.5081 |IoU: 0.3163 | LR: 0.001000
2025-07-22 01:13:56 INFO Epoch 045 | Train Loss: 0.6081 | Val Loss: 0.4363 | Dice: 0.4772 | clDice: 0.4959 |IoU: 0.3138 | LR: 0.001000
2025-07-22 01:14:46 INFO Epoch 046 | Train Loss: 0.6029 | Val Loss: 0.4359 | Dice: 0.4690 | clDice: 0.5020 |IoU: 0.3066 | LR: 0.001000
2025-07-22 01:15:36 INFO Epoch 047 | Train Loss: 0.6054 | Val Loss: 0.4354 | Dice: 0.4674 | clDice: 0.4837 |IoU: 0.3053 | LR: 0.001000
2025-07-22 01:16:27 INFO Epoch 048 | Train Loss: 0.6116 | Val Loss: 0.4166 | Dice: 0.4811 | clDice: 0.4933 |IoU: 0.3172 | LR: 0.001000
2025-07-22 01:17:17 INFO Epoch 049 | Train Loss: 0.6112 | Val Loss: 0.4186 | Dice: 0.4767 | clDice: 0.4991 |IoU: 0.3132 | LR: 0.001000
2025-07-22 01:18:07 INFO Epoch 050 | Train Loss: 0.6119 | Val Loss: 0.4214 | Dice: 0.4849 | clDice: 0.5176 |IoU: 0.3204 | LR: 0.001000
2025-07-22 01:18:57 INFO Epoch 051 | Train Loss: 0.6067 | Val Loss: 0.4198 | Dice: 0.4637 | clDice: 0.4839 |IoU: 0.3021 | LR: 0.001000
2025-07-22 01:19:48 INFO Epoch 052 | Train Loss: 0.6019 | Val Loss: 0.4382 | Dice: 0.4571 | clDice: 0.4834 |IoU: 0.2965 | LR: 0.001000
2025-07-22 01:20:37 INFO Epoch 053 | Train Loss: 0.6085 | Val Loss: 0.4473 | Dice: 0.4782 | clDice: 0.5140 |IoU: 0.3144 | LR: 0.001000
2025-07-22 01:21:26 INFO Epoch 054 | Train Loss: 0.6061 | Val Loss: 0.4243 | Dice: 0.4806 | clDice: 0.5134 |IoU: 0.3167 | LR: 0.001000
2025-07-22 01:22:16 INFO Epoch 055 | Train Loss: 0.6030 | Val Loss: 0.4206 | Dice: 0.4713 | clDice: 0.4989 |IoU: 0.3088 | LR: 0.001000
2025-07-22 01:23:08 INFO Epoch 056 | Train Loss: 0.6029 | Val Loss: 0.4125 | Dice: 0.4903 | clDice: 0.5080 |IoU: 0.3253 | LR: 0.001000
2025-07-22 01:23:58 INFO Epoch 057 | Train Loss: 0.6035 | Val Loss: 0.4271 | Dice: 0.4780 | clDice: 0.5070 |IoU: 0.3146 | LR: 0.001000
2025-07-22 01:24:48 INFO Epoch 058 | Train Loss: 0.6081 | Val Loss: 0.4158 | Dice: 0.4735 | clDice: 0.4973 |IoU: 0.3105 | LR: 0.001000
2025-07-22 01:25:37 INFO Epoch 059 | Train Loss: 0.6042 | Val Loss: 0.4152 | Dice: 0.4755 | clDice: 0.4950 |IoU: 0.3124 | LR: 0.001000
2025-07-22 01:26:28 INFO Epoch 060 | Train Loss: 0.6079 | Val Loss: 0.4142 | Dice: 0.4838 | clDice: 0.4983 |IoU: 0.3196 | LR: 0.001000
2025-07-22 01:27:18 INFO Epoch 061 | Train Loss: 0.6017 | Val Loss: 0.4213 | Dice: 0.4801 | clDice: 0.5100 |IoU: 0.3163 | LR: 0.001000
2025-07-22 01:28:08 INFO Epoch 062 | Train Loss: 0.6036 | Val Loss: 0.4104 | Dice: 0.4900 | clDice: 0.5070 |IoU: 0.3249 | LR: 0.001000
2025-07-22 01:28:58 INFO Epoch 063 | Train Loss: 0.6026 | Val Loss: 0.4364 | Dice: 0.4824 | clDice: 0.5148 |IoU: 0.3181 | LR: 0.001000
2025-07-22 01:29:48 INFO Epoch 064 | Train Loss: 0.6118 | Val Loss: 0.4296 | Dice: 0.4815 | clDice: 0.5042 |IoU: 0.3175 | LR: 0.001000
2025-07-22 01:30:39 INFO Epoch 065 | Train Loss: 0.6045 | Val Loss: 0.4198 | Dice: 0.4853 | clDice: 0.5077 |IoU: 0.3209 | LR: 0.001000
2025-07-22 01:31:29 INFO Epoch 066 | Train Loss: 0.6052 | Val Loss: 0.4181 | Dice: 0.4808 | clDice: 0.4946 |IoU: 0.3170 | LR: 0.001000
2025-07-22 01:32:18 INFO Epoch 067 | Train Loss: 0.6052 | Val Loss: 0.4107 | Dice: 0.4853 | clDice: 0.5098 |IoU: 0.3209 | LR: 0.001000
2025-07-22 01:33:08 INFO Epoch 068 | Train Loss: 0.6075 | Val Loss: 0.4248 | Dice: 0.4865 | clDice: 0.5072 |IoU: 0.3220 | LR: 0.001000
2025-07-22 01:33:59 INFO Epoch 069 | Train Loss: 0.6103 | Val Loss: 0.4097 | Dice: 0.4870 | clDice: 0.5078 |IoU: 0.3224 | LR: 0.001000
2025-07-22 01:34:49 INFO Epoch 070 | Train Loss: 0.6101 | Val Loss: 0.4110 | Dice: 0.4915 | clDice: 0.5250 |IoU: 0.3263 | LR: 0.001000
2025-07-22 01:35:38 INFO Epoch 071 | Train Loss: 0.5990 | Val Loss: 0.4166 | Dice: 0.4847 | clDice: 0.5008 |IoU: 0.3202 | LR: 0.001000
2025-07-22 01:36:27 INFO Epoch 072 | Train Loss: 0.6053 | Val Loss: 0.4220 | Dice: 0.4889 | clDice: 0.5116 |IoU: 0.3239 | LR: 0.001000
2025-07-22 01:37:17 INFO Epoch 073 | Train Loss: 0.6028 | Val Loss: 0.4128 | Dice: 0.4888 | clDice: 0.5111 |IoU: 0.3240 | LR: 0.001000
2025-07-22 01:38:08 INFO Epoch 074 | Train Loss: 0.6095 | Val Loss: 0.4324 | Dice: 0.4821 | clDice: 0.5047 |IoU: 0.3181 | LR: 0.001000
2025-07-22 01:38:57 INFO Epoch 075 | Train Loss: 0.6108 | Val Loss: 0.4133 | Dice: 0.4833 | clDice: 0.5093 |IoU: 0.3191 | LR: 0.001000
2025-07-22 01:39:47 INFO Epoch 076 | Train Loss: 0.6067 | Val Loss: 0.4177 | Dice: 0.4931 | clDice: 0.5276 |IoU: 0.3276 | LR: 0.001000
2025-07-22 01:40:37 INFO Epoch 077 | Train Loss: 0.6083 | Val Loss: 0.4099 | Dice: 0.4861 | clDice: 0.5085 |IoU: 0.3216 | LR: 0.001000
2025-07-22 01:41:27 INFO Epoch 078 | Train Loss: 0.6048 | Val Loss: 0.4163 | Dice: 0.4890 | clDice: 0.5130 |IoU: 0.3241 | LR: 0.001000
2025-07-22 01:42:18 INFO Early stopping at epoch 79 | Best Dice: 0.4931 at epoch 69
Traceback (most recent call last):
  File "/data/smadper@alumno.upv.es/TFM/src/train.py", line 211, in <module>
    main(conf)
  File "/data/smadper@alumno.upv.es/TFM/src/train.py", line 179, in main
    best_model_path, best_dice, best_cldice, best_val_loss, best_epoch = train_model(model, train_loader, test_loader, conf)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: not enough values to unpack (expected 5, got 4)
